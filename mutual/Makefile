## File generated by the BNF Converter (bnfc 2.9.4).

# Makefile for building the parser and test program.

AGDA       = agda-2.6.3
GHC        = ghc
HAPPY      = happy
HAPPY_OPTS = --array --info --ghc --coerce
ALEX       = alex
ALEX_OPTS  = --ghc

## Variables
###########################################################################

grammar		=Mutual

genagdafiles	=$(grammar)/AST.agda $(grammar)/Parser.agda
genhsfiles	=$(grammar)/Print.hs
gengenhsfiles	=$(grammar)/Lex.hs $(grammar)/Par.hs
genfiles        =$(genhsfiles) $(gengenhsfiles) $(genagdafiles)

agdafiles	=Library.agda WellScoped.agda ScopeChecker.agda

ghcflags	=--ghc-flag=-i../haskell --ghc-flag=-Wwarn

###########################################################################

# List of goals not corresponding to file names.

.PHONY : all clean distclean

# Default goal.

.PHONY: test
test : mut
	./mut tests/ex1.agda

.PHONY: test-parser
test-parser : Mutual/Test Main
	./Main tests/ex1.agda

# Build using cabal

.PHONY: build
build : $(genfiles) package.yaml
	$(AGDA) --compile --ghc-dont-call-ghc mut.agda
	hpack && cabal build

.PHONY: run
run :
	cabal run agda-scope-mutual -- tests/ex1.agda

# The extra dependency $(grammar)/Test ensures that the parser is built from $(grammar).cf

mut : mut.agda $(genfiles) $(agdafiles)
	$(AGDA) --compile $(ghcflags) $<

# Rules for building the parser.

Mutual/Abs.hs Mutual/Lex.x Mutual/Par.y Mutual/Print.hs Mutual/Test.hs Mutual/AST.agda Mutual/Parser.agda Mutual/IOLib.agda Mutual/Main.agda : Mutual.cf
	bnfc --haskell -d --agda Mutual.cf

%.hs : %.y
	${HAPPY} ${HAPPY_OPTS} $<

%.hs : %.x
	${ALEX} ${ALEX_OPTS} $<

Mutual/Test : Mutual/Abs.hs Mutual/Lex.hs Mutual/Par.hs Mutual/Print.hs Mutual/Test.hs
	${GHC} ${GHC_OPTS} $@

Main : Mutual/Main.agda Mutual/AST.agda Mutual/Parser.agda Mutual/IOLib.agda Mutual/ErrM.hs Mutual/Lex.hs Mutual/Par.hs Mutual/Print.hs
	${AGDA} --no-libraries --ghc --ghc-flag=-Wwarn $<

# Rules for cleaning generated files.

clean :
	-rm -f Mutual/*.hi Mutual/*.o Mutual/*.log Mutual/*.aux Mutual/*.dvi Mutual/*.agdai
	-rm -rf MAlonzo

distclean : clean
	-rm -f Mutual/Abs.hs Mutual/Abs.hs.bak Mutual/ComposOp.hs Mutual/ComposOp.hs.bak Mutual/Doc.txt Mutual/Doc.txt.bak Mutual/ErrM.hs Mutual/ErrM.hs.bak Mutual/Layout.hs Mutual/Layout.hs.bak Mutual/Lex.x Mutual/Lex.x.bak Mutual/Par.y Mutual/Par.y.bak Mutual/Print.hs Mutual/Print.hs.bak Mutual/Skel.hs Mutual/Skel.hs.bak Mutual/Test.hs Mutual/Test.hs.bak Mutual/XML.hs Mutual/XML.hs.bak Mutual/AST.agda Mutual/AST.agda.bak Mutual/Parser.agda Mutual/Parser.agda.bak Mutual/IOLib.agda Mutual/IOLib.agda.bak Mutual/Main.agda Mutual/Main.agda.bak Mutual/Mutual.dtd Mutual/Mutual.dtd.bak Mutual/Test Mutual/Lex.hs Mutual/Par.hs Mutual/Par.info Mutual/ParData.hs Main Makefile
	-rmdir -p Mutual/

# EOF
